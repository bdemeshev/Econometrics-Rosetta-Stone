<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
<<<<<<< HEAD
  <title>Коан 9 Гетероскедастичность в простой регрессии | Розеттский камень</title>
  <meta name="description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />
=======
  <title>Коан 8 Гетероскедастичность в простой регрессии | Розеттский камень</title>
  <meta name="description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734

  <meta property="og:title" content="Коан 9 Гетероскедастичность в простой регрессии | Розеттский камень" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Коан 9 Гетероскедастичность в простой регрессии | Розеттский камень" />
  
  <meta name="twitter:description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  

<meta name="author" content="Пуассон, фея и три мексиканских негодяя" />


<meta name="date" content="2020-01-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<<<<<<< HEAD
<link rel="prev" href="paneldata.html">
=======
<link rel="prev" href="paneldata.html"/>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
<<<<<<< HEAD
div.sourceCode { margin: 1em 0; }
=======
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
<<<<<<< HEAD
  { content: attr(title);
=======
  { content: attr(data-line-number);
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<<<<<<< HEAD
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Напутственное слово</a></li>
<li class="chapter" data-level="2" data-path="installsoft.html"><a href="installsoft.html"><i class="fa fa-check"></i><b>2</b> Коан об установке софта</a></li>
<li class="chapter" data-level="3" data-path="simplereg.html"><a href="simplereg.html"><i class="fa fa-check"></i><b>3</b> Коан о простой линейной регрессии</a><ul>
<li class="chapter" data-level="3.1" data-path="simplereg.html"><a href="simplereg.html#python"><i class="fa fa-check"></i><b>3.1</b> Python</a></li>
=======
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Приветственный коан</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#язык-программирования-r"><i class="fa fa-check"></i><b>1.1</b> Язык программирования R</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#инструкция-по-установке-rstudio-для-windows-mac-os"><i class="fa fa-check"></i><b>1.1.1</b> Инструкция по установке RStudio для Windows / Mac OS:</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#начало-работы"><i class="fa fa-check"></i><b>1.1.2</b> Начало работы</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#настройка-программы-1"><i class="fa fa-check"></i><b>1.1.3</b> Настройка программы</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#язык-программирования-python"><i class="fa fa-check"></i><b>1.2</b> Язык программирования Python</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#установка"><i class="fa fa-check"></i><b>1.2.1</b> Установка</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#начало-работы-1"><i class="fa fa-check"></i><b>1.2.2</b> Начало работы</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#программа-stata"><i class="fa fa-check"></i><b>1.3</b> Программа STATA</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#установка-1"><i class="fa fa-check"></i><b>1.3.1</b> Установка:</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#начало-работы-2"><i class="fa fa-check"></i><b>1.3.2</b> Начало работы:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="simplereg.html"><a href="simplereg.html"><i class="fa fa-check"></i><b>2</b> Коан о простой линейной регрессии</a><ul>
<li class="chapter" data-level="2.1" data-path="simplereg.html"><a href="simplereg.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="binchoice.html"><a href="binchoice.html"><i class="fa fa-check"></i><b>3</b> Модель бинарного выбора</a><ul>
<li class="chapter" data-level="3.1" data-path="binchoice.html"><a href="binchoice.html#r-1"><i class="fa fa-check"></i><b>3.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multchoice.html"><a href="multchoice.html"><i class="fa fa-check"></i><b>4</b> Модели множественного выбора</a><ul>
<li class="chapter" data-level="4.1" data-path="multchoice.html"><a href="multchoice.html#r-2"><i class="fa fa-check"></i><b>4.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="poisreg.html"><a href="poisreg.html"><i class="fa fa-check"></i><b>5</b> Модели счетных данных</a><ul>
<li class="chapter" data-level="5.1" data-path="poisreg.html"><a href="poisreg.html#r-3"><i class="fa fa-check"></i><b>5.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="arma.html"><a href="arma.html"><i class="fa fa-check"></i><b>6</b> ARMA</a><ul>
<li class="chapter" data-level="6.1" data-path="arma.html"><a href="arma.html#r-4"><i class="fa fa-check"></i><b>6.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>7</b> Коан о панельных данных</a></li>
<li class="chapter" data-level="8" data-path="heterosked.html"><a href="heterosked.html"><i class="fa fa-check"></i><b>8</b> Гетероскедастичность в простой регрессии</a><ul>
<li class="chapter" data-level="8.1" data-path="heterosked.html"><a href="heterosked.html#r-5"><i class="fa fa-check"></i><b>8.1</b> R</a></li>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
</ul></li>
<li class="chapter" data-level="4" data-path="binchoice.html"><a href="binchoice.html"><i class="fa fa-check"></i><b>4</b> Модель бинарного выбора</a></li>
<li class="chapter" data-level="5" data-path="multchoice.html"><a href="multchoice.html"><i class="fa fa-check"></i><b>5</b> Модели множественного выбора</a></li>
<li class="chapter" data-level="6" data-path="poisreg.html"><a href="poisreg.html"><i class="fa fa-check"></i><b>6</b> Модели счетных данных</a></li>
<li class="chapter" data-level="7" data-path="arma.html"><a href="arma.html"><i class="fa fa-check"></i><b>7</b> ARMA</a></li>
<li class="chapter" data-level="8" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>8</b> Коан о панельных данных</a></li>
<li class="chapter" data-level="9" data-path="heterosked.html"><a href="heterosked.html"><i class="fa fa-check"></i><b>9</b> Гетероскедастичность в простой регрессии</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Розеттский камень</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="heterosked" class="section level1">
<h1><span class="header-section-number">Коан 9</span> Гетероскедастичность в простой регрессии</h1>
<blockquote>
<p>Одним из нарушений условий ТГМ является гетероскедастичность, возникающая ввиду неодинаковых дисперсий для разных наблюдений.
Она нежелательна ввиду того, что оценки МНК не являются эффективными (но остаются несмещёнными), и предпосылки для использования <code>t</code>-статистик нарушены, что даёт неверный результат о значимости коэффициентов.</p>
</blockquote>
<p>Этот коан благословит Вас на поиски гетероскедастичности и просветит о способах борьбы с ней.</p>
<p>Будем анализировать гетероскедастичность на данных о стоимости квартир.</p>
<blockquote>
<p>Мини-теория:</p>
</blockquote>
<p><strong>Тест Уайта</strong></p>
<p>Он неконструктивный, он может лишь показать наличие гетероскедастичности, асимптотический. Нормальность остатков в предпосылках не требуется, подразумевается, что <span class="math display">\[E({\varepsilon^4_i}) = const\]</span>.</p>
<p><span class="math display">\[
\begin{cases}
H_0: \sigma^2_i = \sigma^2 \\
H_1: \sigma^2_i \neq = \sigma^2 \\
\end{cases}
\]</span></p>
<p>На первом шаге тест сохраняет остатки от построения начальной регрессии.
<span class="math display">\[
\hat{\ln{(pricemetr_i)}} = \hat{\beta}_0 + \hat{\beta}_{\ln{(kitsp)}} \cdot \ln{(kitsp_i)} + \hat{\beta}_{\ln{(livesp)}}\cdot \ln{(livesp_i)} + \hat{\beta}_{\ln{(dist)}}\cdot \ln{(dist_i)} + \hat{\beta}_{\ln{(metrdist)}}\cdot \ln{(metrdist_i)}
\]</span>
На втором - строится вспомогательная регрессия (X_j-вектор j-го фактора).
<span class="math display">\[
\hat{e}^2_i = \hat{\alpha}_0 + \sum_{j=1}^{k} \hat{\alpha}_j \cdot X_j + \sum_{j=1}^{k} \hat{\gamma}_j \cdot X^2_j + \sum_{j &lt; m}^{k} \hat{\delta}_j X_j \cdot X_m
\]</span></p>
<p><code>R-squared</code> построенной вспомогательной регрессии должен быть распределён как:
<span class="math display">\[
n \cdot R^2_{aux} \sim \chi^2_{K-1}
\]</span>
где <code>K</code> – число факторов во вспомогательной регрессии.</p>
<p><strong>Тест Бройша - Пагана</strong></p>
<p>Тест Бройша - Пагана — обобщённый вариант теста Уайта.
В тесте Бройша-Пагана во вспомогательной регрессии можно брать любые функции от регрессоров, в тесте Уайта - регрессоры, их квадраты и кросс-произведения.
Тест Бройша-Пагана является асимптотическим.</p>
<p><span class="math display">\[
\begin{cases}
H_0: \sigma^2_i = \sigma^2 \\
H_1: \sigma^2_i \propto f(\alpha_0 + \alpha_1 \cdot Z_1 +  \ldots + \alpha_p \cdot Z_p) \\
\end{cases}
\]</span></p>
<p>Классическая версия Бройша - Пагана строится на основе метода максимального правдоподобия. Предпосылками классической версии теста являются нормальность остатков, существование у функции дисперсии из альтернативной гипотезы первой и второй производной.
Считается LM-статистика, которая, при верной основной гипотезе об отсутствии гетероскедастичности, имеет хи-квадратное распределение с p-1 степенью свободы.</p>
<p>Современная модификация теста не требует нормальности остатков, лишь <span class="math display">\[{\mathbb E}({\varepsilon^4_i}) = const\]</span>.</p>
<p>На первом шаге строится исходная регрессия и сохраняются остатки.
Затем строится состоятельная оценка дисперсии:
<span class="math display">\[
\hat{\sigma}^2 = \frac{1}{n} \cdot \sum_{i=1}^{n} {e^2_i}
\]</span></p>
<p>Потом строится вспомогательная регрессия:</p>
<p><span class="math display">\[
\frac{e^2}{\hat{\sigma}^2} = \alpha_0 + \alpha_1 \cdot Z_1 + \ldots + \alpha_p \cdot Z_p + u
\]</span></p>
<p>И рассчитывается тестовая статистика:</p>
<p><span class="math display">\[
\frac{RSS_{aux}}{2} \sim \chi^2_{p}
\]</span></p>
<p><strong>Тест Голдфелда - Квандта</strong></p>
<p><span class="math display">\[
\begin{cases}
H_0: \sigma^2_i = \sigma^2 \\
H_1: \sigma^2_i \propto X_i \\
\end{cases}
\]</span></p>
<p>Этот тест предполагает нормальность остатков и является неасимптотическим.</p>
<p>Процедура:</p>
<p>Сначала все наблюдения сортируются по возрастанию абсолютного значения фактора, вызывающего гетероскедастичность.</p>
<p>Затем отсортированный ряд по фактору делится на 3 примерно равные части. Считаются гетероскедастичности по первой и третьей части ряда.
Строится <code>F</code>- статистика:</p>
<p><span class="math display">\[
\frac{RSS_2}{RSS_1} \sim F_{r - k, r-k}
\]</span></p>
<p><strong>WLS как способ борьбы с гетероскедастичностью</strong></p>
<p>Веса – оценка обратной дисперсии переменной, вызывающей гетероскедачность.</p>
<p>То есть оценим регрессию:
<span class="math display">\[
\frac{\ln{(pricemetr_i)}}{\hat{\sigma}_i} = 
\frac{\beta_0}{\hat{\sigma}_i} + 
\frac{\beta_{\ln{(kitsp)}} \cdot \ln{(kitsp_i)}}{\hat{\sigma}_i} + \frac{\beta_{\ln{(livesp)}} \cdot \ln{(livesp_i)}}{\hat{\sigma}_i} + \frac{\beta_{\ln{(dist)}} \cdot \ln{(dist_i)}}{\hat{\sigma}_i} + \frac{\beta_{\ln{(metrdist)}} \cdot \ln{(metrdist_i)}}{\hat{\sigma}_i} + \frac{\varepsilon_i}{\hat{\sigma}_i}
\]</span></p>
<p>где <code>r</code> - размер первой и третьей частей отсортированного ряда.</p>
<<<<<<< HEAD

</div>
=======
<div id="r-5" class="section level2">
<h2><span class="header-section-number">8.1</span> R</h2>
<p>Вызовем <strong>R</strong> в помощь в охоте на гетероскедастичность. Импортируем его оружейные пакеты.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="kw">library</span>(rio) <span class="co"># импорт и экспорт данных в разных форматах</span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2"><span class="kw">library</span>(dplyr) <span class="co"># манипуляции с данными</span></a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="kw">library</span>(lmtest) <span class="co"># тест Бройша-Пагана</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="kw">library</span>(sandwich) <span class="co"># оценка дисперсии при гетероскедастичности</span></a>
<a class="sourceLine" id="cb138-5" data-line-number="5"><span class="kw">library</span>(UStatBookABSC) <span class="co"># WLS</span></a>
<a class="sourceLine" id="cb138-6" data-line-number="6"><span class="kw">library</span>(estimatr) <span class="co"># получение робастных оценок</span></a>
<a class="sourceLine" id="cb138-7" data-line-number="7"><span class="kw">library</span>(ggpubr) <span class="co"># для графиков</span></a>
<a class="sourceLine" id="cb138-8" data-line-number="8"><span class="kw">library</span>(skimr) <span class="co"># для описательных статистик</span></a></code></pre></div>
<p>Импортируем наш dataset, <code>flats.dta</code>:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">flats =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;../data/10_flats.dta&quot;</span>)</a></code></pre></div>
<p>Рассмотрим описательные статистики загруженного датасета.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="kw">skim</span>(flats)</a></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-7">Table 3.2: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">flats</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">773</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">44</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">42</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sanuzel__1_razdel__0_sovm_</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">okrug</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">n</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">395.48</td>
<td align="right">228.89</td>
<td align="right">1.00</td>
<td align="right">196.00</td>
<td align="right">397.00</td>
<td align="right">595.00</td>
<td align="right">7.880e+02</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td align="left">rooms</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▁▁▇▁▁</td>
</tr>
<tr class="odd">
<td align="left">price</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7548674.66</td>
<td align="right">2492693.71</td>
<td align="right">3300000.00</td>
<td align="right">5750000.00</td>
<td align="right">6700000.00</td>
<td align="right">8600000.00</td>
<td align="right">1.750e+07</td>
<td align="left">▇▇▃▁▁</td>
</tr>
<tr class="even">
<td align="left">totsp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">37.82</td>
<td align="right">9.90</td>
<td align="right">15.00</td>
<td align="right">32.00</td>
<td align="right">38.00</td>
<td align="right">42.00</td>
<td align="right">7.500e+01</td>
<td align="left">▂▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">livesp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">21.45</td>
<td align="right">7.25</td>
<td align="right">8.00</td>
<td align="right">18.00</td>
<td align="right">19.00</td>
<td align="right">21.00</td>
<td align="right">6.500e+01</td>
<td align="left">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td align="left">kitsp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.09</td>
<td align="right">2.85</td>
<td align="right">2.00</td>
<td align="right">6.00</td>
<td align="right">8.00</td>
<td align="right">10.00</td>
<td align="right">2.400e+01</td>
<td align="left">▅▇▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">dist</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.19</td>
<td align="right">4.66</td>
<td align="right">5.00</td>
<td align="right">9.00</td>
<td align="right">11.50</td>
<td align="right">15.00</td>
<td align="right">2.550e+01</td>
<td align="left">▆▇▅▁▁</td>
</tr>
<tr class="even">
<td align="left">metrdist</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.83</td>
<td align="right">4.44</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.00</td>
<td align="right">10.00</td>
<td align="right">4.000e+01</td>
<td align="left">▇▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">walk</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.46</td>
<td align="right">0.50</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">brick</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.16</td>
<td align="right">0.37</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td align="left">tel</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.91</td>
<td align="right">0.30</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">3.000e+00</td>
<td align="left">▁▇▁▁▁</td>
</tr>
<tr class="even">
<td align="left">bal</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.53</td>
<td align="right">0.50</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">floor</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.83</td>
<td align="right">0.38</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▂▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">new</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.31</td>
<td align="right">0.46</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▃</td>
</tr>
<tr class="odd">
<td align="left">floors</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">15.71</td>
<td align="right">9.09</td>
<td align="right">3.00</td>
<td align="right">9.00</td>
<td align="right">14.00</td>
<td align="right">19.00</td>
<td align="right">4.800e+01</td>
<td align="left">▇▅▂▂▁</td>
</tr>
<tr class="even">
<td align="left">nfloor</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7.93</td>
<td align="right">7.99</td>
<td align="right">1.00</td>
<td align="right">3.00</td>
<td align="right">6.00</td>
<td align="right">11.00</td>
<td align="right">1.270e+02</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">floor1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.10</td>
<td align="right">0.30</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">floor2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.07</td>
<td align="right">0.26</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">nw</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.41</td>
<td align="right">0.49</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▆</td>
</tr>
<tr class="even">
<td align="left">w</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.20</td>
<td align="right">0.40</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td align="left">sw</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.39</td>
<td align="right">0.49</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.000e+00</td>
<td align="left">▇▁▁▁▅</td>
</tr>
<tr class="even">
<td align="left">price_meter</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">207308.48</td>
<td align="right">74861.22</td>
<td align="right">84930.44</td>
<td align="right">167187.50</td>
<td align="right">189393.90</td>
<td align="right">223076.90</td>
<td align="right">6.000e+05</td>
<td align="left">▇▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">ln_price_meter</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.19</td>
<td align="right">0.30</td>
<td align="right">11.35</td>
<td align="right">12.03</td>
<td align="right">12.15</td>
<td align="right">12.32</td>
<td align="right">1.330e+01</td>
<td align="left">▁▇▇▁▁</td>
</tr>
<tr class="even">
<td align="left">ln_livesp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.02</td>
<td align="right">0.27</td>
<td align="right">2.08</td>
<td align="right">2.89</td>
<td align="right">2.94</td>
<td align="right">3.04</td>
<td align="right">4.170e+00</td>
<td align="left">▁▃▇▁▁</td>
</tr>
<tr class="odd">
<td align="left">ln_totsp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.60</td>
<td align="right">0.28</td>
<td align="right">2.71</td>
<td align="right">3.47</td>
<td align="right">3.64</td>
<td align="right">3.74</td>
<td align="right">4.320e+00</td>
<td align="left">▁▁▇▅▁</td>
</tr>
<tr class="even">
<td align="left">ln_kitsp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.02</td>
<td align="right">0.41</td>
<td align="right">0.69</td>
<td align="right">1.79</td>
<td align="right">2.08</td>
<td align="right">2.30</td>
<td align="right">3.180e+00</td>
<td align="left">▂▁▇▇▁</td>
</tr>
<tr class="odd">
<td align="left">ln_dist</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.43</td>
<td align="right">0.40</td>
<td align="right">1.61</td>
<td align="right">2.20</td>
<td align="right">2.44</td>
<td align="right">2.71</td>
<td align="right">3.240e+00</td>
<td align="left">▂▃▇▅▂</td>
</tr>
<tr class="even">
<td align="left">ln_metrdist</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.04</td>
<td align="right">0.55</td>
<td align="right">0.00</td>
<td align="right">1.61</td>
<td align="right">2.30</td>
<td align="right">2.30</td>
<td align="right">3.690e+00</td>
<td align="left">▁▁▆▇▁</td>
</tr>
<tr class="odd">
<td align="left">ln_metrdist_walk</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.97</td>
<td align="right">1.09</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">2.08</td>
<td align="right">3.690e+00</td>
<td align="left">▇▁▃▃▁</td>
</tr>
<tr class="even">
<td align="left">ln_livesp_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9.22</td>
<td align="right">1.74</td>
<td align="right">4.32</td>
<td align="right">8.35</td>
<td align="right">8.67</td>
<td align="right">9.27</td>
<td align="right">1.743e+01</td>
<td align="left">▁▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">ln_totsp_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13.01</td>
<td align="right">1.94</td>
<td align="right">7.33</td>
<td align="right">12.01</td>
<td align="right">13.23</td>
<td align="right">13.97</td>
<td align="right">1.864e+01</td>
<td align="left">▁▂▇▃▁</td>
</tr>
<tr class="even">
<td align="left">ln_kitsp_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.24</td>
<td align="right">1.48</td>
<td align="right">0.48</td>
<td align="right">3.21</td>
<td align="right">4.32</td>
<td align="right">5.30</td>
<td align="right">1.010e+01</td>
<td align="left">▂▇▆▁▁</td>
</tr>
<tr class="odd">
<td align="left">ln_dist_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.04</td>
<td align="right">1.88</td>
<td align="right">2.59</td>
<td align="right">4.83</td>
<td align="right">5.97</td>
<td align="right">7.33</td>
<td align="right">1.049e+01</td>
<td align="left">▅▅▇▅▂</td>
</tr>
<tr class="even">
<td align="left">ln_metrdist_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.49</td>
<td align="right">2.07</td>
<td align="right">0.00</td>
<td align="right">2.59</td>
<td align="right">5.30</td>
<td align="right">5.30</td>
<td align="right">1.361e+01</td>
<td align="left">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="left">ln_floors</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.59</td>
<td align="right">0.59</td>
<td align="right">1.10</td>
<td align="right">2.20</td>
<td align="right">2.64</td>
<td align="right">2.94</td>
<td align="right">3.870e+00</td>
<td align="left">▃▅▆▇▃</td>
</tr>
<tr class="even">
<td align="left">ln_nfloor</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.70</td>
<td align="right">0.89</td>
<td align="right">0.00</td>
<td align="right">1.10</td>
<td align="right">1.79</td>
<td align="right">2.40</td>
<td align="right">4.840e+00</td>
<td align="left">▅▆▇▂▁</td>
</tr>
<tr class="odd">
<td align="left">ln_floors_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7.05</td>
<td align="right">3.03</td>
<td align="right">1.21</td>
<td align="right">4.83</td>
<td align="right">6.96</td>
<td align="right">8.67</td>
<td align="right">1.499e+01</td>
<td align="left">▃▇▇▅▂</td>
</tr>
<tr class="even">
<td align="left">ln_nfloor_sq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.69</td>
<td align="right">3.04</td>
<td align="right">0.00</td>
<td align="right">1.21</td>
<td align="right">3.21</td>
<td align="right">5.75</td>
<td align="right">2.347e+01</td>
<td align="left">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">non_livesp</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.29</td>
<td align="right">4.65</td>
<td align="right">0.00</td>
<td align="right">5.00</td>
<td align="right">8.00</td>
<td align="right">11.00</td>
<td align="right">2.500e+01</td>
<td align="left">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td align="left">ln_totsp2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13.01</td>
<td align="right">1.94</td>
<td align="right">7.33</td>
<td align="right">12.01</td>
<td align="right">13.23</td>
<td align="right">13.97</td>
<td align="right">1.864e+01</td>
<td align="left">▁▂▇▃▁</td>
</tr>
<tr class="odd">
<td align="left">ln_totsp3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">28.34</td>
<td align="right">8.55</td>
<td align="right">8.99</td>
<td align="right">24.15</td>
<td align="right">25.53</td>
<td align="right">28.22</td>
<td align="right">7.274e+01</td>
<td align="left">▂▇▁▁▁</td>
</tr>
<tr class="even">
<td align="left">ln_price_metr</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12.19</td>
<td align="right">0.30</td>
<td align="right">11.35</td>
<td align="right">12.03</td>
<td align="right">12.15</td>
<td align="right">12.32</td>
<td align="right">1.330e+01</td>
<td align="left">▁▇▇▁▁</td>
</tr>
</tbody>
</table>
<p>Построим простую линейную регрессионную модель, на которой будем проверять гетероскедастичность.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">reg =<span class="st"> </span><span class="kw">lm</span>(ln_price_metr <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>ln_livesp <span class="op">+</span><span class="st"> </span>ln_kitsp <span class="op">+</span><span class="st"> </span>ln_dist <span class="op">+</span><span class="st"> </span>ln_metrdist, <span class="dt">data =</span> flats)</a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="kw">summary</span>(reg)</a></code></pre></div>
<pre><code>
Call:
lm(formula = ln_price_metr ~ 1 + ln_livesp + ln_kitsp + ln_dist + 
    ln_metrdist, data = flats)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.62723 -0.16125 -0.00845  0.13614  0.77618 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.19920    0.13492 105.243  &lt; 2e-16 ***
ln_livesp   -0.16053    0.03723  -4.312 1.83e-05 ***
ln_kitsp    -0.29913    0.02300 -13.007  &lt; 2e-16 ***
ln_dist     -0.33025    0.02367 -13.952  &lt; 2e-16 ***
ln_metrdist -0.05738    0.01560  -3.679 0.000251 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.2309 on 768 degrees of freedom
Multiple R-squared:  0.4179,    Adjusted R-squared:  0.4149 
F-statistic: 137.9 on 4 and 768 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Проверим наличие гетероскедастичности визуально. Построим зависимости цены квартир от объясняющих факторов.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">kit =<span class="st"> </span><span class="kw">ggplot</span>(flats) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ln_kitsp, <span class="dt">y =</span> ln_price_metr)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Площадь кухни, кв.м&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Цена квартиры, $1000&quot;</span>, </a>
<a class="sourceLine" id="cb143-3" data-line-number="3">  <span class="dt">title =</span> <span class="st">&quot;Стоимость квартир в Москве&quot;</span>)</a>
<a class="sourceLine" id="cb143-4" data-line-number="4">live =<span class="st"> </span><span class="kw">ggplot</span>(flats) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ln_livesp, <span class="dt">y =</span> ln_price_metr)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb143-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Жилая площадь, кв.м&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Цена квартиры, $1000&quot;</span>, </a>
<a class="sourceLine" id="cb143-6" data-line-number="6">  <span class="dt">title =</span> <span class="st">&quot;Стоимость квартир в Москве&quot;</span>)</a>
<a class="sourceLine" id="cb143-7" data-line-number="7">dist =<span class="st"> </span><span class="kw">ggplot</span>(flats) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ln_dist, <span class="dt">y =</span> ln_price_metr)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb143-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Расстояние до центра, м&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Цена квартиры, $1000&quot;</span>,</a>
<a class="sourceLine" id="cb143-9" data-line-number="9">  <span class="dt">title =</span> <span class="st">&quot;Стоимость квартир в Москве&quot;</span>)</a>
<a class="sourceLine" id="cb143-10" data-line-number="10">metrdist =<span class="st"> </span><span class="kw">ggplot</span>(flats) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ln_metrdist, <span class="dt">y =</span> ln_price_metr)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb143-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Расстояние до метро, м&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Цена квартиры, $1000&quot;</span>, </a>
<a class="sourceLine" id="cb143-12" data-line-number="12">  <span class="dt">title =</span> <span class="st">&quot;Стоимость квартир в Москве&quot;</span>)</a>
<a class="sourceLine" id="cb143-13" data-line-number="13"></a>
<a class="sourceLine" id="cb143-14" data-line-number="14"><span class="kw">ggarrange</span>(kit, live, dist, metrdist, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="10-heterosked_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Из сета красивых графиков видно, что гетероскедастичность присутствует. В частности, подозрительны переменные <code>ln_kitsp</code> и <code>ln_metrdist</code>.</p>
<p>Проверим наличие гетероскедастичности с помощью тестов.</p>
<p>Начнём с теста Уайта.</p>
<p>Тест Уайта реализуется в <strong>R</strong> (ручками) как:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">bptest</span>(reg, <span class="dt">varformula =</span> <span class="op">~</span><span class="st"> </span>(ln_livesp <span class="op">+</span><span class="st"> </span>ln_kitsp <span class="op">+</span><span class="st"> </span>ln_dist <span class="op">+</span><span class="st"> </span>ln_metrdist)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(ln_livesp <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(ln_kitsp <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(ln_dist <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(ln_metrdist <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb144-2" data-line-number="2">       <span class="dt">data =</span> flats)</a></code></pre></div>
<pre><code>
    studentized Breusch-Pagan test

data:  reg
BP = 89.02, df = 14, p-value = 5.81e-13</code></pre>
<p>Тест Уайта выявил гетероскедастичность.</p>
<p>Проведём тест Бройша - Пагана.</p>
<p>Классическая версия Бройша - Пагана реализуется в <strong>r</strong> по команде:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">bptest</span>(reg, <span class="dt">studentize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>
    Breusch-Pagan test

data:  reg
BP = 18.39, df = 4, p-value = 0.001035</code></pre>
<p>Модифицированная версия теста Бройша - Пагана реализуется по команде:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw">bptest</span>(reg)</a></code></pre></div>
<pre><code>
    studentized Breusch-Pagan test

data:  reg
BP = 15.778, df = 4, p-value = 0.003332</code></pre>
<p>Причем, если отдельно не указать спецификацию вспомогательной регрессии, то <code>bptest()</code> возьмёт все регрессоры исходной модели.</p>
<p>В обеих версиях теста Бройша - Пагана гетероскедастичность обнаружена.</p>
<p>Ещё есть тест Голдфелда - Квандта.</p>
<p>Предположим, что дисперсии случайных ошибок растут с ростом площади кухни, <code>kitsp</code>.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">flats_ordered =<span class="st"> </span><span class="kw">arrange</span>(flats, kitsp)</a>
<a class="sourceLine" id="cb150-2" data-line-number="2">reg_gqtest =<span class="st"> </span><span class="kw">lm</span>(ln_price_metr <span class="op">~</span><span class="st"> </span>ln_livesp <span class="op">+</span><span class="st"> </span>ln_kitsp <span class="op">+</span><span class="st"> </span>ln_dist <span class="op">+</span><span class="st"> </span>ln_metrdist,</a>
<a class="sourceLine" id="cb150-3" data-line-number="3">                <span class="dt">data =</span> flats_ordered)</a>
<a class="sourceLine" id="cb150-4" data-line-number="4"><span class="kw">gqtest</span>(reg_gqtest, <span class="dt">fraction =</span> <span class="fl">0.34</span>) <span class="co"># посередине отсортированного ряда лежит 34% наблюдений</span></a></code></pre></div>
<pre><code>
    Goldfeld-Quandt test

data:  reg_gqtest
GQ = 1.1072, df1 = 251, df2 = 250, p-value = 0.2106
alternative hypothesis: variance increases from segment 1 to 2</code></pre>
<p>Будет также полезным познакомиться с методами борьбы с гетероскедастичностью.</p>
<p>Способ 1. Взвешенный МНК.
В <strong>R</strong> его можно осуществить так:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">reg_wls =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> flats, </a>
<a class="sourceLine" id="cb152-2" data-line-number="2">             ln_price_metr <span class="op">~</span><span class="st"> </span>ln_livesp <span class="op">+</span><span class="st"> </span>ln_kitsp <span class="op">+</span><span class="st"> </span>ln_dist <span class="op">+</span><span class="st"> </span>ln_metrdist, </a>
<a class="sourceLine" id="cb152-3" data-line-number="3">             <span class="dt">weights =</span> <span class="kw">fitted</span>(<span class="kw">lm</span>(<span class="kw">abs</span>(<span class="kw">residuals</span>(reg)) <span class="op">~</span><span class="st"> </span>ln_kitsp)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb152-4" data-line-number="4"><span class="kw">summary</span>(reg_wls)</a></code></pre></div>
<pre><code>
Call:
lm(formula = ln_price_metr ~ ln_livesp + ln_kitsp + ln_dist + 
    ln_metrdist, data = flats, weights = fitted(lm(abs(residuals(reg)) ~ 
    ln_kitsp))^2)

Weighted Residuals:
      Min        1Q    Median        3Q       Max 
-0.105299 -0.029659 -0.001107  0.025053  0.155867 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.28313    0.13557 105.357  &lt; 2e-16 ***
ln_livesp   -0.16102    0.03849  -4.183  3.2e-05 ***
ln_kitsp    -0.33901    0.02245 -15.098  &lt; 2e-16 ***
ln_dist     -0.33075    0.02406 -13.749  &lt; 2e-16 ***
ln_metrdist -0.05859    0.01587  -3.691 0.000239 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.04242 on 768 degrees of freedom
Multiple R-squared:  0.4683,    Adjusted R-squared:  0.4655 
F-statistic: 169.1 on 4 and 768 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>!!!! Проверить веса!!!!</p>
<p>Способ 2. Робастные оценки Уайта.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">reg_hc =<span class="st"> </span><span class="kw">lm_robust</span>(<span class="dt">data =</span> flats,</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">  ln_price_metr <span class="op">~</span><span class="st"> </span>ln_livesp <span class="op">+</span><span class="st"> </span>ln_kitsp <span class="op">+</span><span class="st"> </span>ln_dist <span class="op">+</span><span class="st"> </span>ln_metrdist)</a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="kw">summary</span>(reg_hc)</a></code></pre></div>
<pre><code>
Call:
lm_robust(formula = ln_price_metr ~ ln_livesp + ln_kitsp + ln_dist + 
    ln_metrdist, data = flats)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value  Pr(&gt;|t|) CI Lower CI Upper  DF
(Intercept) 14.19920    0.15982  88.846 0.000e+00 13.88546 14.51293 768
ln_livesp   -0.16053    0.04114  -3.902 1.039e-04 -0.24129 -0.07976 768
ln_kitsp    -0.29913    0.02855 -10.476 4.275e-24 -0.35518 -0.24308 768
ln_dist     -0.33025    0.02409 -13.710 1.992e-38 -0.37754 -0.28296 768
ln_metrdist -0.05738    0.01460  -3.930 9.271e-05 -0.08604 -0.02871 768

Multiple R-squared:  0.4179 ,   Adjusted R-squared:  0.4149 
F-statistic: 102.1 on 4 and 768 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Робастные оценки коэффициентов регрессии получаются состоятельными.</p>

</div>
</div>






>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
            </section>

          </div>
        </div>
      </div>
<a href="paneldata.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["Rosetta_Stone.pdf", "Rosetta_Stone.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
