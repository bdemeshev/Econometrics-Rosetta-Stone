<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Коан 2 Коан о простой линейной регрессии | Розеттский камень</title>
  <meta name="description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Коан 2 Коан о простой линейной регрессии | Розеттский камень" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Коан 2 Коан о простой линейной регрессии | Розеттский камень" />
  
  <meta name="twitter:description" content="Сборник коанов для эконометристов, жаждущих просветления." />
  

<meta name="author" content="Пуассон, фея и три мексиканских негодяя" />


<meta name="date" content="2020-01-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<<<<<<< HEAD
<link rel="prev" href="installsoft.html">
<link rel="next" href="binchoice.html">
=======
<link rel="prev" href="index.html"/>
<link rel="next" href="binchoice.html"/>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<<<<<<< HEAD
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Напутственное слово</a></li>
<li class="chapter" data-level="2" data-path="installsoft.html"><a href="installsoft.html"><i class="fa fa-check"></i><b>2</b> Коан об установке софта</a></li>
<li class="chapter" data-level="3" data-path="simplereg.html"><a href="simplereg.html"><i class="fa fa-check"></i><b>3</b> Коан о простой линейной регрессии</a><ul>
<li class="chapter" data-level="3.1" data-path="simplereg.html"><a href="simplereg.html#python"><i class="fa fa-check"></i><b>3.1</b> Python</a></li>
=======
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Приветственный коан</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#язык-программирования-r"><i class="fa fa-check"></i><b>1.1</b> Язык программирования R</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#инструкция-по-установке-rstudio-для-windows-mac-os"><i class="fa fa-check"></i><b>1.1.1</b> Инструкция по установке RStudio для Windows / Mac OS:</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#начало-работы"><i class="fa fa-check"></i><b>1.1.2</b> Начало работы</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#настройка-программы-1"><i class="fa fa-check"></i><b>1.1.3</b> Настройка программы</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#язык-программирования-python"><i class="fa fa-check"></i><b>1.2</b> Язык программирования Python</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#установка"><i class="fa fa-check"></i><b>1.2.1</b> Установка</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#начало-работы-1"><i class="fa fa-check"></i><b>1.2.2</b> Начало работы</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#программа-stata"><i class="fa fa-check"></i><b>1.3</b> Программа STATA</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#установка-1"><i class="fa fa-check"></i><b>1.3.1</b> Установка:</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#начало-работы-2"><i class="fa fa-check"></i><b>1.3.2</b> Начало работы:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="simplereg.html"><a href="simplereg.html"><i class="fa fa-check"></i><b>2</b> Коан о простой линейной регрессии</a><ul>
<li class="chapter" data-level="2.1" data-path="simplereg.html"><a href="simplereg.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="binchoice.html"><a href="binchoice.html"><i class="fa fa-check"></i><b>3</b> Модель бинарного выбора</a><ul>
<li class="chapter" data-level="3.1" data-path="binchoice.html"><a href="binchoice.html#r-1"><i class="fa fa-check"></i><b>3.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multchoice.html"><a href="multchoice.html"><i class="fa fa-check"></i><b>4</b> Модели множественного выбора</a><ul>
<li class="chapter" data-level="4.1" data-path="multchoice.html"><a href="multchoice.html#r-2"><i class="fa fa-check"></i><b>4.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="poisreg.html"><a href="poisreg.html"><i class="fa fa-check"></i><b>5</b> Модели счетных данных</a><ul>
<li class="chapter" data-level="5.1" data-path="poisreg.html"><a href="poisreg.html#r-3"><i class="fa fa-check"></i><b>5.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="arma.html"><a href="arma.html"><i class="fa fa-check"></i><b>6</b> ARMA</a><ul>
<li class="chapter" data-level="6.1" data-path="arma.html"><a href="arma.html#r-4"><i class="fa fa-check"></i><b>6.1</b> R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>7</b> Коан о панельных данных</a></li>
<li class="chapter" data-level="8" data-path="heterosked.html"><a href="heterosked.html"><i class="fa fa-check"></i><b>8</b> Гетероскедастичность в простой регрессии</a><ul>
<li class="chapter" data-level="8.1" data-path="heterosked.html"><a href="heterosked.html#r-5"><i class="fa fa-check"></i><b>8.1</b> R</a></li>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
</ul></li>
<li class="chapter" data-level="4" data-path="binchoice.html"><a href="binchoice.html"><i class="fa fa-check"></i><b>4</b> Модель бинарного выбора</a></li>
<li class="chapter" data-level="5" data-path="multchoice.html"><a href="multchoice.html"><i class="fa fa-check"></i><b>5</b> Модели множественного выбора</a></li>
<li class="chapter" data-level="6" data-path="poisreg.html"><a href="poisreg.html"><i class="fa fa-check"></i><b>6</b> Модели счетных данных</a></li>
<li class="chapter" data-level="7" data-path="arma.html"><a href="arma.html"><i class="fa fa-check"></i><b>7</b> ARMA</a></li>
<li class="chapter" data-level="8" data-path="paneldata.html"><a href="paneldata.html"><i class="fa fa-check"></i><b>8</b> Коан о панельных данных</a></li>
<li class="chapter" data-level="9" data-path="heterosked.html"><a href="heterosked.html"><i class="fa fa-check"></i><b>9</b> Гетероскедастичность в простой регрессии</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Розеттский камень</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simplereg" class="section level1">
<<<<<<< HEAD
<h1><span class="header-section-number">Коан 3</span> Коан о простой линейной регрессии</h1>
<div id="python" class="section level2">
<h2><span class="header-section-number">3.1</span> Python</h2>
<p>Опять начинаем с импорта пакетов.
Почти всегда джентельменский набор включает в себя <em>pandas</em>, <em>numpy</em> и <em>matplotlib.pyplot</em>.
Много полезных функций для статистических расчетов можно найти в модуле Statsmodels.</p>
<pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># работа с таблицами</span>
<span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># математические функции и матрицы</span>
<span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># графики</span>
<span class="im">import</span> seaborn <span class="im">as</span> sns <span class="co"># еще более классные графики</span>

<span class="im">import</span> statsmodels.api <span class="im">as</span> sm <span class="co"># стандартные регресионные модели</span>
<span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf <span class="co"># аналогичные модели с синтаксисом в стиле R</span>
<span class="im">import</span> statsmodels.graphics.gofplots <span class="im">as</span> gf <span class="co"># визуализация моделей</span>
<span class="im">import</span> statsmodels.discrete.discrete_model <span class="co"># дискретные модели</span>

<span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> summary_table <span class="co"># работа с выбросами</span>
<span class="im">from</span> scipy.stats <span class="im">import</span> shapiro <span class="co"># тест Шапиро – Уилка </span></code></pre>
<p>При желании можем настроить графики по своему вкусу, изменив <a href="https://tonysyu.github.io/raw_content/matplotlib-style-gallery/gallery.html">стиль</a> и другие параметры шрифтов и графиков :)</p>
<pre class="sourceCode python"><code class="sourceCode python">plt.style.use(<span class="st">&#39;seaborn&#39;</span>)
plt.rc(<span class="st">&#39;font&#39;</span>, size<span class="op">=</span><span class="dv">14</span>)
plt.rc(<span class="st">&#39;figure&#39;</span>, titlesize<span class="op">=</span><span class="dv">15</span>)
plt.rc(<span class="st">&#39;axes&#39;</span>, labelsize<span class="op">=</span><span class="dv">15</span>)
plt.rc(<span class="st">&#39;axes&#39;</span>, titlesize<span class="op">=</span><span class="dv">15</span>)</code></pre>
<p>Загрузим данные.</p>
<pre class="sourceCode python"><code class="sourceCode python">returns <span class="op">=</span> pd.read_stata(<span class="st">&#39;../data/02_us_return.dta&#39;</span>)</code></pre>
<p>Переименуем столбцы с «неговорящими» названиями :)
Параметр <code>inplace=True</code> здесь (и во многих других функциях) позволяет изменить объект, не возвращая его копию.</p>
<pre class="sourceCode python"><code class="sourceCode python">returns.rename(columns<span class="op">=</span>{<span class="st">&#39;A&#39;</span>:<span class="st">&#39;n&#39;</span>, <span class="st">&#39;B&#39;</span>: <span class="st">&#39;date&#39;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</code></pre>
<p>Избавимся от наблюдений с пропущенными значениями.</p>
<pre class="sourceCode python"><code class="sourceCode python">returns.dropna(inplace<span class="op">=</span><span class="va">True</span>)</code></pre>
<p>Как и прежде, рассмотрим CAPM модель :)
Оценим <code>бэту</code> для компании MOTOR.
Тогда зависимая переменная - разница доходностей акций MOTOR и безрискового актива (<code>motor_premium</code>), а регрессор - рыночная премия (<code>market_premium</code>).</p>
<pre class="sourceCode python"><code class="sourceCode python">returns[<span class="st">&#39;motor_premium&#39;</span>] <span class="op">=</span> returns[<span class="st">&#39;MOTOR&#39;</span>] <span class="op">-</span> returns[<span class="st">&#39;RKFREE&#39;</span>]
returns[<span class="st">&#39;market_premium&#39;</span>] <span class="op">=</span> returns[<span class="st">&#39;MARKET&#39;</span>] <span class="op">-</span> returns[<span class="st">&#39;RKFREE&#39;</span>] </code></pre>
<p>Оценим модель и посмотрим на саммари :)</p>
<pre class="sourceCode python"><code class="sourceCode python">regr <span class="op">=</span> smf.ols(<span class="st">&#39;motor_premium ~ market_premium&#39;</span>, data<span class="op">=</span>returns).fit()
regr.summary()</code></pre>
<pre><code>&lt;class &#39;statsmodels.iolib.summary.Summary&#39;&gt;
&quot;&quot;&quot;
                            OLS Regression Results                            
==============================================================================
Dep. Variable:          motor_premium   R-squared:                       0.357
Model:                            OLS   Adj. R-squared:                  0.351
Method:                 Least Squares   F-statistic:                     65.48
Date:                Sat, 18 Jan 2020   Prob (F-statistic):           5.91e-13
Time:                        13:07:40   Log-Likelihood:                 136.18
No. Observations:                 120   AIC:                            -268.4
Df Residuals:                     118   BIC:                            -262.8
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept          0.0053      0.007      0.730      0.467      -0.009       0.020
market_premium     0.8481      0.105      8.092      0.000       0.641       1.056
==============================================================================
Omnibus:                        2.684   Durbin-Watson:                   2.030
Prob(Omnibus):                  0.261   Jarque-Bera (JB):                1.780
Skew:                          -0.031   Prob(JB):                        0.411
Kurtosis:                       2.406   Cond. No.                         14.6
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
&quot;&quot;&quot;</code></pre>
<p>Можем посчитать прогнозное значение.</p>
<pre class="sourceCode python"><code class="sourceCode python">returns[<span class="st">&#39;yhat&#39;</span>] <span class="op">=</span> regr.fittedvalues <span class="co"># в R добавить для исходных, а сюда для новых</span></code></pre>
<p>Красивые графики для остатков, выборосов и прочих радостей, как в R, придется строить ручками. Зато приятно поиграть с оформлением :)</p>
<pre class="sourceCode python"><code class="sourceCode python">fig, ax <span class="op">=</span> plt.subplots()
ax.plot(returns[<span class="st">&#39;x&#39;</span>],regr.fittedvalues, color<span class="op">=</span><span class="st">&#39;g&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): KeyError: &#39;x&#39;

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\frame.py&quot;, line 2975, in __getitem__
    indexer = self.columns.get_loc(key)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\indexes\base.py&quot;, line 2892, in get_loc
    return self._engine.get_loc(self._maybe_cast_indexer(key))
  File &quot;pandas/_libs/index.pyx&quot;, line 107, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/index.pyx&quot;, line 131, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1607, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1614, in pandas._libs.hashtable.PyObjectHashTable.get_item</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">ax.scatter(returns[<span class="st">&#39;x&#39;</span>],regr.fittedvalues <span class="op">+</span> regr.resid, color<span class="op">=</span><span class="st">&#39;g&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, s<span class="op">=</span><span class="dv">40</span>)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): KeyError: &#39;x&#39;

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\frame.py&quot;, line 2975, in __getitem__
    indexer = self.columns.get_loc(key)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\indexes\base.py&quot;, line 2892, in get_loc
    return self._engine.get_loc(self._maybe_cast_indexer(key))
  File &quot;pandas/_libs/index.pyx&quot;, line 107, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/index.pyx&quot;, line 131, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1607, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1614, in pandas._libs.hashtable.PyObjectHashTable.get_item</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">ax.vlines(returns[<span class="st">&#39;x&#39;</span>],regr.fittedvalues,regr.fittedvalues <span class="op">+</span> regr.resid, color<span class="op">=</span><span class="st">&#39;gray&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): KeyError: &#39;x&#39;

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\frame.py&quot;, line 2975, in __getitem__
    indexer = self.columns.get_loc(key)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\indexes\base.py&quot;, line 2892, in get_loc
    return self._engine.get_loc(self._maybe_cast_indexer(key))
  File &quot;pandas/_libs/index.pyx&quot;, line 107, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/index.pyx&quot;, line 131, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1607, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1614, in pandas._libs.hashtable.PyObjectHashTable.get_item</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">plt.title(<span class="st">&#39;Линия регрессии и остатки&#39;</span>)
plt.xlabel(<span class="st">&#39;RKFREE&#39;</span>)
plt.ylabel(<span class="st">&#39;MARKET&#39;</span>)
plt.show()</code></pre>
<p><img src="02-simplereg_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Строим <span class="math inline">\(90\%\)</span>-й доверительный интервал.</p>
<pre class="sourceCode python"><code class="sourceCode python">regr.conf_int(alpha <span class="op">=</span> <span class="fl">0.1</span>)</code></pre>
<pre><code>                       0         1
Intercept      -0.006684  0.017189
market_premium  0.674382  1.021917</code></pre>
<p>И проведем F-test.</p>
<pre class="sourceCode python"><code class="sourceCode python">hypotheses <span class="op">=</span> <span class="st">&#39;(x = 1)&#39;</span>
regr.f_test(r_matrix <span class="op">=</span> hypotheses)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): PatsyError: unrecognized token in constraint
    (x = 1)
     ^

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\statsmodels\base\model.py&quot;, line 1648, in f_test
    res = self.wald_test(r_matrix, cov_p=cov_p, invcov=invcov, use_f=True)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\statsmodels\base\model.py&quot;, line 1719, in wald_test
    LC = DesignInfo(names).linear_constraint(r_matrix)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\patsy\design_info.py&quot;, line 536, in linear_constraint
    return linear_constraint(constraint_likes, self.column_names)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\patsy\constraint.py&quot;, line 403, in linear_constraint
    tree = parse_constraint(code, variable_names)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\patsy\constraint.py&quot;, line 237, in parse_constraint
    return infix_parse(_tokenize_constraint(string, variable_names),
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\patsy\constraint.py&quot;, line 196, in _tokenize_constraint
    Origin(string, offset, offset + 1))</code></pre>
<p>Тест Шапиро - Уилка. Такой же, как и в R.</p>
<pre class="sourceCode python"><code class="sourceCode python">W, p_value <span class="op">=</span> shapiro(regr.resid)</code></pre>
<p>Генерируем новые данные и строим предсказание.</p>
<pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> random
random.seed(<span class="dv">7</span>)

new_data <span class="op">=</span> returns[<span class="st">&#39;x&#39;</span>] <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> np.random.normal(<span class="bu">len</span>(returns))</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): KeyError: &#39;x&#39;

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\frame.py&quot;, line 2975, in __getitem__
    indexer = self.columns.get_loc(key)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\indexes\base.py&quot;, line 2892, in get_loc
    return self._engine.get_loc(self._maybe_cast_indexer(key))
  File &quot;pandas/_libs/index.pyx&quot;, line 107, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/index.pyx&quot;, line 131, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1607, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1614, in pandas._libs.hashtable.PyObjectHashTable.get_item</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">prediction <span class="op">=</span> regr.predict(new_data)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): NameError: name &#39;new_data&#39; is not defined

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</code></pre>
<p>А теперь жесть! Построим графички, похожие на <code>plot()</code> R.</p>
<pre class="sourceCode python"><code class="sourceCode python">fig_1 <span class="op">=</span> plt.figure(<span class="dv">1</span>)

fig_1.axes[<span class="dv">0</span>] <span class="op">=</span> sns.residplot(returns[<span class="st">&#39;x&#39;</span>], returns[<span class="st">&#39;y&#39;</span>],
                                  lowess<span class="op">=</span><span class="va">True</span>,
                                  scatter_kws<span class="op">=</span>{<span class="st">&#39;alpha&#39;</span>: <span class="fl">0.6</span>},
                                  line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">2</span>, <span class="st">&#39;alpha&#39;</span>: <span class="fl">0.8</span>})</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): KeyError: &#39;x&#39;

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\frame.py&quot;, line 2975, in __getitem__
    indexer = self.columns.get_loc(key)
  File &quot;C:\Users\DNS\ANACON~1\lib\site-packages\pandas\core\indexes\base.py&quot;, line 2892, in get_loc
    return self._engine.get_loc(self._maybe_cast_indexer(key))
  File &quot;pandas/_libs/index.pyx&quot;, line 107, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/index.pyx&quot;, line 131, in pandas._libs.index.IndexEngine.get_loc
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1607, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File &quot;pandas/_libs/hashtable_class_helper.pxi&quot;, line 1614, in pandas._libs.hashtable.PyObjectHashTable.get_item</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">fig_1.axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Residuals vs Fitted&#39;</span>)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): IndexError: list index out of range

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">fig_1.axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Fitted values&#39;</span>)</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): IndexError: list index out of range

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">fig_1.axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;Residuals&#39;</span>)


<span class="co"># можем добавить метки потенциальных аутлаеров</span></code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): IndexError: list index out of range

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">abs_resid <span class="op">=</span> <span class="bu">abs</span>(regr.resid).sort_values(ascending<span class="op">=</span><span class="va">False</span>)
abs_resid_top3<span class="op">=</span>abs_resid[:<span class="dv">3</span>]

<span class="cf">for</span> i <span class="kw">in</span> abs_resid_top3.index:
    fig_1.axes[<span class="dv">0</span>].annotate(i, 
                               xy <span class="op">=</span> (regr.fittedvalues[i], 
                                   regr.resid[i]))</code></pre>
<pre><code>Error in py_call_impl(callable, dots$args, dots$keywords): IndexError: list index out of range

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 2, in &lt;module&gt;</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">norm_residuals <span class="op">=</span> regr.get_influence().resid_studentized_internal <span class="co"># сохраним стьюдентизированные остатки </span>


QQ <span class="op">=</span> gf.ProbPlot(norm_residuals)
fig_2 <span class="op">=</span> QQ.qqplot(line<span class="op">=</span><span class="st">&#39;45&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>, lw<span class="op">=</span><span class="dv">1</span>)


fig_2.axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Normal Q-Q&#39;</span>)
fig_2.axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Theoretical Quantiles&#39;</span>)
fig_2.axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;Standardized Residuals&#39;</span>)<span class="op">;</span>

<span class="co">#и снова метки</span>
abs_norm_resid <span class="op">=</span> np.flip(np.argsort(<span class="bu">abs</span>(norm_residuals)), <span class="dv">0</span>)
abs_norm_resid_top3 <span class="op">=</span> abs_norm_resid[:<span class="dv">3</span>]

<span class="cf">for</span> r, i <span class="kw">in</span> <span class="bu">enumerate</span>(abs_norm_resid_top3):
    fig_2.axes[<span class="dv">0</span>].annotate(i, 
                               xy<span class="op">=</span>(np.flip(QQ.theoretical_quantiles, <span class="dv">0</span>)[r],
                                   norm_residuals[i]))</code></pre>
<p><img src="02-simplereg_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="sourceCode python"><code class="sourceCode python">fig_3 <span class="op">=</span> plt.figure(<span class="dv">3</span>)

plt.scatter(regr.fittedvalues, np.sqrt(<span class="bu">abs</span>(norm_residuals)), alpha<span class="op">=</span><span class="fl">0.5</span>)
sns.regplot(regr.fittedvalues, np.sqrt(<span class="bu">abs</span>(norm_residuals)), 
            scatter<span class="op">=</span><span class="va">False</span>, 
            ci<span class="op">=</span><span class="va">False</span>, 
            lowess<span class="op">=</span><span class="va">True</span>,
            line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;alpha&#39;</span>: <span class="fl">0.6</span>})

fig_3.axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Scale-Location&#39;</span>)
fig_3.axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Fitted values&#39;</span>)
fig_3.axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;$\sqrt{|Standardized Residuals|}$&#39;</span>)

<span class="co"># и еще раз!)</span>
abs_sq_norm_resid <span class="op">=</span> np.flip(np.argsort(np.sqrt(<span class="bu">abs</span>(norm_residuals)), <span class="dv">0</span>))
abs_sq_norm_resid_top3 <span class="op">=</span> abs_sq_norm_resid[:<span class="dv">3</span>]

<span class="cf">for</span> i <span class="kw">in</span> abs_sq_norm_resid_top3:
    fig_3.axes[<span class="dv">0</span>].annotate(i, xy<span class="op">=</span>(regr.fittedvalues[i], 
                                   np.sqrt(<span class="bu">abs</span>(norm_residuals)[i])))</code></pre>
<p><img src="02-simplereg_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="sourceCode python"><code class="sourceCode python">leverage <span class="op">=</span> regr.get_influence().hat_matrix_diag <span class="co"># сохраняем элементы матрицы-шляпницы</span>
cook_dist <span class="op">=</span> regr.get_influence().cooks_distance[<span class="dv">0</span>] <span class="co"># и расстояние Кука</span>

fig_4 <span class="op">=</span> plt.figure(<span class="dv">4</span>)

plt.scatter(leverage, norm_residuals, alpha<span class="op">=</span><span class="fl">0.5</span>)
sns.regplot(leverage, norm_residuals, 
            scatter<span class="op">=</span><span class="va">False</span>, 
            ci<span class="op">=</span><span class="va">False</span>, 
            lowess<span class="op">=</span><span class="va">True</span>,
            line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;alpha&#39;</span>: <span class="fl">0.8</span>})

fig_4.axes[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="fl">0.20</span>)  <span class="co"># РАЗВЕСТИ НА ОТДЕЛЬНЫЕ ЧАНКИ ИЛИ MESSAGE = FALSE</span></code></pre>
<pre><code>(0, 0.2)</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">fig_4.axes[<span class="dv">0</span>].set_ylim(<span class="op">-</span><span class="dv">3</span>, <span class="dv">5</span>)</code></pre>
<pre><code>(-3, 5)</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">fig_4.axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Residuals vs Leverage&#39;</span>)
fig_4.axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Leverage&#39;</span>)
fig_4.axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;Standardized Residuals&#39;</span>)


leverage_top3 <span class="op">=</span> np.flip(np.argsort(cook_dist), <span class="dv">0</span>)[:<span class="dv">3</span>]

<span class="cf">for</span> i <span class="kw">in</span> leverage_top3:
    fig_4.axes[<span class="dv">0</span>].annotate(i, 
                               xy<span class="op">=</span>(leverage[i], 
                                   norm_residuals[i]))
plt.show()</code></pre>
<p><img src="02-simplereg_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
=======
<h1><span class="header-section-number">Коан 2</span> Коан о простой линейной регрессии</h1>
<div id="r" class="section level2">
<h2><span class="header-section-number">2.1</span> R</h2>
<p>Построим простую линейную регрессию в R и проведем несложные тесты.</p>
<p>Загрузим необходимые пакеты.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(tidyverse) <span class="co"># манипуляции с данными и построение графиков</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(sjPlot) <span class="co"># красивые графики для линейных моделей</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">library</span>(skimr) <span class="co"># симпатичное summary</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">library</span>(rio) <span class="co"># чтение .dta файлов</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">library</span>(car) <span class="co"># проверка линейных гипотез</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">library</span>(tseries) <span class="co"># тест Харке – Бера</span></a></code></pre></div>
<p>Импортируем данные.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">returns =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;../data/02_us_return.dta&quot;</span>)</a></code></pre></div>
<p>Исследуем наш датасет.
Функция <code>skim()</code> позволяет получить красивую и приятную в работе табличку (<code>tibble</code>), содержащую типы переменных и различные описательные статистики.
Для удобства выведем результаты только для переменных <code>MOTOR</code> и <code>rkfree</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">skim</span>(returns) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(skim_variable <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;MOTOR&#39;</span>, <span class="st">&#39;rkfree&#39;</span>)) </a></code></pre></div>
<table>
<caption><span id="tab:skim">Table 2.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">returns</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">2664</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">22</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MOTOR</td>
<td align="right">2544</td>
<td align="right">0.05</td>
<td align="right">0.02</td>
<td align="right">0.1</td>
<td align="right">-0.33</td>
<td align="right">-0.05</td>
<td align="right">0.02</td>
<td align="right">0.08</td>
<td align="right">0.27</td>
<td align="left">▁▂▇▇▁</td>
</tr>
<tr class="even">
<td align="left">rkfree</td>
<td align="right">2544</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="left">▂▇▇▂▂</td>
</tr>
</tbody>
</table>
<p>Переименуем столбцы с «неговорящими» названиями :)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">returns =<span class="st"> </span><span class="kw">rename</span>(returns, <span class="dt">n =</span> A, <span class="dt">date =</span> B) </a></code></pre></div>
<p>И уберем строчки, в которых хотя бы один элемент пустой.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">returns=<span class="st"> </span><span class="kw">na.omit</span>(returns)</a></code></pre></div>
<p>Будем верить в CAPM :) (в начале объяснить, что такое capm)
Оценим параметры модели для компании MOTOR. Тогда зависимая переменная - разница доходностей акций MOTOR и безрискового актива (<code>motor_premium</code>), а регрессор - рыночная премия (<code>market_premium</code>).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">returns =<span class="st"> </span><span class="kw">mutate</span>(returns, <span class="dt">motor_premium =</span> MOTOR <span class="op">-</span><span class="st"> </span>RKFREE, <span class="dt">market_premium =</span> MARKET <span class="op">-</span><span class="st"> </span>RKFREE)</a></code></pre></div>
<p>Оценим нашу модель и проверим гипотезу об адекватности регрессии.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">ols =<span class="st"> </span><span class="kw">lm</span>(motor_premium <span class="op">~</span><span class="st"> </span>market_premium, <span class="dt">data =</span> returns)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">summary</span>(ols)</a></code></pre></div>
<pre><code>
Call:
lm(formula = motor_premium ~ market_premium, data = returns)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.168421 -0.059381 -0.003399  0.061373  0.182991 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    0.005253   0.007200   0.730    0.467    
market_premium 0.848150   0.104814   8.092 5.91e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.07844 on 118 degrees of freedom
Multiple R-squared:  0.3569,    Adjusted R-squared:  0.3514 
F-statistic: 65.48 on 1 and 118 DF,  p-value: 5.913e-13</code></pre>
<p>Вызовом одной функции получаем кучу полезных графиков :)
Можем визуально оценить наличие гетероскедастичности, нормальность распределения остатков, наличие выбросов.
Без дополнительных указаний функция построит 4 графика – по одному друг за другом.
Мы для красоты c помощью функции <code>par</code> будем выводить по два графика :)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">plot</span>(ols) </a></code></pre></div>
<p><img src="02-simplereg_files/figure-html/plot-1.png" width="672" /></p>
<p>График <strong>«Residuals vs Fitted»</strong> помогает уловить возможные нелинейные зависимости между регрессором и объясняемой переменной.
В «хорошем» случае мы ждем картинку с остатками, равномерно рассеянными вдоль горизонтальной прямой.
В нашем случае несколько выбиваются наблюдения с отрицательной рыночной премией.</p>
<p>График <strong>«Normal Q – Q»</strong> позволяет визуально оценить нормальность распределения остатков.
Эталоном здесь является пунктирная прямая.
На графике функция распределения остатков нашей модели «похожа» на нормальную :)</p>
<p>График <strong>«Scale – Location»</strong> дает возможность «на глаз» оценить равную дисперсию остатков регресии и проверить наличие гетероскедастичности.
За исключением немногочисленных наблюдений с отрицательной рыночной премией, в нашем случае предположение о гомоскедастичности (одинаковой дисперсии) остатков кажется верным.</p>
<p>График <strong>«Residuals vs Leverage»</strong> помогает выявить «влиятельные наблюдения» с высоким «воздействием» (high leverage).
Это такие наблюдения, которые имеют нетипичные для выборки значения, но исключение которых может значительно повлиять на оценки коэффициентов модели.
На графике они располагаются справа, за границами, обозначенными красной пунктирной линией (расстояние Кука).</p>
<p>Теперь построим <span class="math inline">\(90\%\)</span>-й доверительный интервал для параметров модели.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">confint</span>(ols, <span class="dt">level =</span> <span class="fl">0.9</span>)</a></code></pre></div>
<pre><code>                        5 %       95 %
(Intercept)    -0.006683687 0.01718942
market_premium  0.674382048 1.02191711</code></pre>
<p>И заодно проверим гипотезу о равенстве коэффициента при регрессоре единице.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">linearHypothesis</span>(ols, <span class="kw">c</span>(<span class="st">&quot;market_premium = 1&quot;</span>))</a></code></pre></div>
<pre><code>Linear hypothesis test

Hypothesis:
market_premium = 1

Model 1: restricted model
Model 2: motor_premium ~ market_premium

  Res.Df     RSS Df Sum of Sq      F Pr(&gt;F)
1    119 0.73900                           
2    118 0.72608  1  0.012915 2.0989 0.1501</code></pre>
<p>Видим, что на любом разумном уровне значимости она не отвергается.</p>
<p>Теперь посмотрим на остатки регрессии :) Протестируем их на нормальность с помощью теста Харке – Бера.</p>
<p><span class="math display">\[
H_{0}: S = 0, K = 3,
\]</span>
где S — коэффициент асимметрии (Skewness), K — коэффициент эксцесса (Kurtosis)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">jarque.bera.test</span>(<span class="kw">resid</span>(ols)) </a></code></pre></div>
<pre><code>
    Jarque Bera Test

data:  resid(ols)
X-squared = 1.7803, df = 2, p-value = 0.4106</code></pre>
<p>И заодно посмотрим на результаты теста Шапиро – Уилка.</p>
<p><span class="math display">\[
H_{0}: \epsilon_{i} \sim  N(\mu,\sigma^2)
\]</span></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(ols))</a></code></pre></div>
<pre><code>
    Shapiro-Wilk normality test

data:  resid(ols)
W = 0.99021, p-value = 0.5531</code></pre>
<p>Оба теста указывают на нормальность распределения остатков.</p>
<p>Получим предсказания модели для обучаемой выборки.</p>
<div id="додумать" class="section level4">
<h4><span class="header-section-number">2.1.0.1</span> ДОДУМАТЬ</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">fitval =<span class="st"> </span><span class="kw">fitted</span>(ols)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">fit_vs_real =<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">fitted =</span> fitval, <span class="dt">real =</span> returns<span class="op">$</span>market_premium)</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">qplot</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(fitval), <span class="dt">y =</span> returns<span class="op">$</span>market_premium, </a>
<a class="sourceLine" id="cb22-2" data-line-number="2">      <span class="dt">xlab =</span> <span class="st">&quot;Number of observation&quot;</span>, </a>
<a class="sourceLine" id="cb22-3" data-line-number="3">      <span class="dt">ylab =</span> <span class="st">&quot;Value&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> fitval, <span class="dt">color =</span> <span class="st">&#39;r&#39;</span>))</a></code></pre></div>
<p><img src="02-simplereg_files/figure-html/fit%20vs%20real-1.png" width="672" /></p>
<p>Выведем прогноз модели по <span class="math inline">\(20\)</span> новым наблюдениям (которые сами же и придумаем).
Будем считать, что новые наблюдения распределены нормально с математическим ожиданием <span class="math inline">\(0.01\)</span> и дисперсией <span class="math inline">\(0.01\)</span>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">7</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">new_data =<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">market_premium =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> <span class="fl">0.01</span>, <span class="dt">sd =</span> <span class="fl">0.1</span>)) </a>
<a class="sourceLine" id="cb23-3" data-line-number="3">yhat =<span class="st"> </span><span class="kw">predict</span>(ols, <span class="dt">newdata =</span> new_data, <span class="dt">se =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">yhat<span class="op">$</span>fit</a></code></pre></div>
<pre><code>           1            2            3            4            5 
 0.207727133 -0.087769779 -0.045152029 -0.021234248 -0.068593258 
           6            7            8            9           10 
-0.066609148  0.077187768  0.003814809  0.026682011  0.199477263 </code></pre>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<<<<<<< HEAD
<a href="installsoft.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
=======
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
>>>>>>> 2d5797527741ec10cca1ef2ca525a6bab26d4734
<a href="binchoice.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["Rosetta_Stone.pdf", "Rosetta_Stone.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
